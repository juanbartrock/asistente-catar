# Stage 1: build
FROM node:18-alpine as builder
WORKDIR /app

# Copio archivos de dependencias y uso npm install para instalaci贸n reproducible (sin --production para incluir devDependencies para build)
COPY package.json package-lock.json* ./
RUN npm install --loglevel error --silent

# Copio el resto del c贸digo y construyo
COPY . .
RUN npm run build

# Stage 2: producci贸n
FROM node:18-alpine as runner
WORKDIR /app
ENV NODE_ENV=production
COPY --from=builder /app .
# Remuevo devDependencies para producci贸n
RUN npm prune --production
EXPOSE 3000
CMD ["npm", "run", "start"] 